//
//  oc.m
//  jwgl
//
//  Created by 杨培文 on 15/1/6.
//  Copyright (c) 2015年 杨培文. All rights reserved.
//

#import "oc.h"

@implementation oc

const unsigned char yzm1[] = {
    0,0,0,0,0,1,1,0,0,
    0,0,0,1,1,1,1,0,0,
    0,0,0,1,1,1,1,0,0,
    0,0,0,0,0,1,1,0,0,
    0,0,0,0,0,1,1,0,0,
    0,0,0,0,0,1,1,0,0,
    0,0,0,0,0,1,1,0,0,
    0,0,0,0,0,1,1,0,0,
    0,0,0,0,0,1,1,0,0,
    0,0,0,0,0,1,1,0,0,
    0,0,0,1,1,1,1,1,1,
    0,0,0,1,1,1,1,1,1,
};
const unsigned char yzm2[] = {
    0,0,1,1,1,1,1,0,0,
    0,1,1,1,1,1,1,1,0,
    0,1,0,0,0,0,0,1,1,
    0,0,0,0,0,0,0,1,1,
    0,0,0,0,0,0,0,1,1,
    0,0,0,0,0,0,1,1,0,
    0,0,0,0,1,1,1,0,0,
    0,0,0,1,1,0,0,0,0,
    0,0,1,1,0,0,0,0,0,
    0,1,1,0,0,0,0,0,0,
    0,1,1,1,1,1,1,1,1,
    0,1,1,1,1,1,1,1,1,
};
const unsigned char yzm3[] = {
    0,0,1,1,1,1,1,0,0,
    0,1,1,1,1,1,1,1,0,
    0,1,0,0,0,0,1,1,1,
    0,0,0,0,0,0,0,1,1,
    0,0,0,0,0,0,1,1,0,
    0,0,0,1,1,1,1,0,0,
    0,0,0,1,1,1,1,1,0,
    0,0,0,0,0,0,1,1,1,
    0,0,0,0,0,0,0,1,1,
    0,1,0,0,0,0,1,1,1,
    0,1,1,1,1,1,1,1,0,
    0,0,1,1,1,1,1,0,0,
};
const unsigned char yzmb[] = {
    0,1,1,0,0,0,0,0,0,
    0,1,1,0,0,0,0,0,0,
    0,1,1,0,0,0,0,0,0,
    0,1,1,0,1,1,1,1,0,
    0,1,1,1,1,1,1,1,1,
    0,1,1,1,0,0,0,1,1,
    0,1,1,0,0,0,0,0,1,
    0,1,1,0,0,0,0,0,1,
    0,1,1,0,0,0,0,0,1,
    0,1,1,1,0,0,0,1,1,
    0,1,1,1,1,1,1,1,1,
    0,1,1,0,1,1,1,1,0,
};
const unsigned char yzmc[] = {
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,1,1,1,1,1,0,
    0,0,1,1,1,1,1,1,0,
    0,1,1,1,0,0,0,0,0,
    0,1,1,0,0,0,0,0,0,
    0,1,1,0,0,0,0,0,0,
    0,1,1,0,0,0,0,0,0,
    0,1,1,1,0,0,0,0,0,
    0,0,1,1,1,1,1,1,0,
    0,0,0,1,1,1,1,1,0,
};
const unsigned char yzmm[] = {
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,1,1,0,1,1,1,1,0,
    0,1,1,1,1,1,1,1,1,
    0,1,1,1,0,0,0,1,1,
    0,1,1,0,0,0,0,1,1,
    0,1,1,0,0,0,0,1,1,
    0,1,1,0,0,0,0,1,1,
    0,1,1,0,0,0,0,1,1,
    0,1,1,0,0,0,0,1,1,
    0,1,1,0,0,0,0,1,1,
};
const unsigned char yzmn[] = {
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,1,1,0,0,1,1,1,1,
    0,1,1,0,1,1,1,1,1,
    0,1,1,1,1,0,0,0,1,
    0,1,1,1,0,0,0,0,1,
    0,1,1,0,0,0,0,0,1,
    0,1,1,0,0,0,0,0,1,
    0,1,1,0,0,0,0,0,1,
    0,1,1,0,0,0,0,0,1,
    0,1,1,0,0,0,0,0,1,
};
const unsigned char yzmv[] = {
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    1,1,0,0,0,0,0,1,1,
    0,1,1,0,0,0,1,1,0,
    0,1,1,0,0,0,1,1,0,
    0,1,1,0,0,0,1,1,0,
    0,0,1,1,0,1,1,0,0,
    0,0,1,1,0,1,1,0,0,
    0,0,1,1,0,1,1,0,0,
    0,0,0,1,1,1,0,0,0,
    0,0,0,1,1,1,0,0,0,
};
const unsigned char yzmx[] = {
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    1,1,1,0,0,0,1,1,1,
    0,1,1,0,0,0,1,1,0,
    0,0,1,1,0,1,1,0,0,
    0,0,0,1,1,1,0,0,0,
    0,0,0,1,1,1,0,0,0,
    0,0,0,1,1,1,0,0,0,
    0,0,1,1,0,1,1,0,0,
    0,1,1,0,0,0,1,1,0,
    1,1,1,0,0,0,1,1,1,
};
const unsigned char yzmz[] = {
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,1,1,1,1,1,1,1,0,
    0,1,1,1,1,1,1,1,0,
    0,0,0,0,0,1,1,0,0,
    0,0,0,0,1,1,0,0,0,
    0,0,0,1,1,0,0,0,0,
    0,0,1,1,0,0,0,0,0,
    0,1,1,0,0,0,0,0,0,
    0,1,1,1,1,1,1,1,0,
    0,1,1,1,1,1,1,1,0,
};

const unsigned char yzmw0[] = {
    0,0,0,0,1,1,1,0,0,0,
    0,0,1,1,1,1,1,1,1,0,
    0,0,1,1,0,0,0,1,1,0,
    0,1,1,0,0,0,0,0,1,1,
    0,1,1,0,0,0,0,0,1,1,
    0,1,1,0,0,0,0,0,1,1,
    0,1,1,0,0,0,0,0,1,1,
    0,1,1,0,0,0,0,0,1,1,
    0,1,1,0,0,0,0,0,1,1,
    0,1,1,0,0,0,0,0,1,1,
    0,0,1,1,0,0,0,1,1,0,
    0,0,1,1,1,1,1,1,1,0,
    0,0,0,0,1,1,1,0,0,0,
};
const unsigned char yzmw1[] = {
    0,0,0,0,1,1,1,0,0,0,
    0,0,1,1,1,1,1,0,0,0,
    0,0,1,1,1,1,1,0,0,0,
    0,0,0,0,0,1,1,0,0,0,
    0,0,0,0,0,1,1,0,0,0,
    0,0,0,0,0,1,1,0,0,0,
    0,0,0,0,0,1,1,0,0,0,
    0,0,0,0,0,1,1,0,0,0,
    0,0,0,0,0,1,1,0,0,0,
    0,0,0,0,0,1,1,0,0,0,
    0,0,0,0,0,1,1,0,0,0,
    0,0,1,1,1,1,1,1,1,1,
    0,0,1,1,1,1,1,1,1,1,
};
const unsigned char yzmw2[] = {
    0,0,1,1,1,1,1,0,0,0,
    0,1,1,1,1,1,1,1,0,0,
    0,1,0,0,0,0,0,1,1,0,
    0,0,0,0,0,0,0,1,1,0,
    0,0,0,0,0,0,0,1,1,0,
    0,0,0,0,0,0,1,1,0,0,
    0,0,0,0,0,1,1,0,0,0,
    0,0,0,0,1,1,0,0,0,0,
    0,0,0,1,1,0,0,0,0,0,
    0,0,1,1,0,0,0,0,0,0,
    0,1,1,0,0,0,0,0,0,0,
    0,1,1,1,1,1,1,1,1,0,
    0,1,1,1,1,1,1,1,1,0,
};
const unsigned char yzmw3[] = {
    0,0,1,1,1,1,1,0,0,0,
    0,1,1,1,1,1,1,1,1,0,
    0,1,0,0,0,0,0,1,1,0,
    0,0,0,0,0,0,0,1,1,0,
    0,0,0,0,0,0,1,1,0,0,
    0,0,1,1,1,1,1,0,0,0,
    0,0,1,1,1,1,1,1,0,0,
    0,0,0,0,0,0,1,1,1,0,
    0,0,0,0,0,0,0,1,1,0,
    0,0,0,0,0,0,0,1,1,0,
    0,1,0,0,0,0,1,1,1,0,
    0,1,1,1,1,1,1,1,0,0,
    0,0,1,1,1,1,1,0,0,0,
};
const unsigned char yzmw4[] = {
    0,0,0,0,0,0,1,1,0,0,
    0,0,0,0,0,1,1,1,0,0,
    0,0,0,0,0,1,1,1,0,0,
    0,0,0,0,1,1,1,1,0,0,
    0,0,0,1,1,0,1,1,0,0,
    0,0,0,1,1,0,1,1,0,0,
    0,0,1,1,0,0,1,1,0,0,
    0,0,1,1,0,0,1,1,0,0,
    0,1,1,1,1,1,1,1,1,1,
    0,1,1,1,1,1,1,1,1,1,
    0,0,0,0,0,0,1,1,0,0,
    0,0,0,0,0,0,1,1,0,0,
    0,0,0,0,0,0,1,1,0,0,
};
const unsigned char yzmw5[] = {
    0,1,1,1,1,1,1,1,1,0,
    0,1,1,1,1,1,1,1,1,0,
    0,1,1,0,0,0,0,0,0,0,
    0,1,1,0,0,0,0,0,0,0,
    0,1,1,0,0,0,0,0,0,0,
    0,1,1,1,1,1,0,0,0,0,
    0,1,1,1,1,1,1,1,0,0,
    0,0,0,0,0,0,1,1,1,0,
    0,0,0,0,0,0,0,1,1,0,
    0,0,0,0,0,0,0,1,1,0,
    0,1,0,0,0,0,1,1,1,0,
    0,1,1,1,1,1,1,1,0,0,
    0,0,1,1,1,1,1,0,0,0,
};
const unsigned char yzmw6[] = {
    0,0,0,0,1,1,1,1,0,0,
    0,0,0,1,1,1,1,1,1,0,
    0,0,1,1,0,0,0,0,1,0,
    0,0,1,1,0,0,0,0,0,0,
    0,1,1,0,0,0,0,0,0,0,
    0,1,1,0,1,1,1,1,0,0,
    0,1,1,1,1,1,1,1,1,0,
    0,1,1,1,0,0,0,1,1,1,
    0,1,1,0,0,0,0,0,1,1,
    0,1,1,0,0,0,0,0,1,1,
    0,0,1,1,0,0,0,1,1,1,
    0,0,1,1,1,1,1,1,1,0,
    0,0,0,0,1,1,1,1,0,0,
};
const unsigned char yzmw7[] = {
    0,0,1,1,1,1,1,1,1,1,
    0,0,1,1,1,1,1,1,1,1,
    0,0,0,0,0,0,0,0,1,1,
    0,0,0,0,0,0,0,0,1,0,
    0,0,0,0,0,0,0,1,1,0,
    0,0,0,0,0,0,1,1,0,0,
    0,0,0,0,0,0,1,0,0,0,
    0,0,0,0,0,1,1,0,0,0,
    0,0,0,0,0,1,0,0,0,0,
    0,0,0,0,1,1,0,0,0,0,
    0,0,0,0,1,1,0,0,0,0,
    0,0,0,1,1,0,0,0,0,0,
    0,0,0,1,1,0,0,0,0,0,
};
const unsigned char yzmw8[] = {
    0,0,0,1,1,1,1,1,0,0,
    0,0,1,1,1,1,1,1,0,0,
    0,0,1,1,0,0,0,1,1,0,
    0,0,1,1,0,0,0,1,1,0,
    0,0,1,1,1,0,0,1,0,0,
    0,0,0,1,1,1,1,1,0,0,
    0,0,0,1,1,1,1,1,0,0,
    0,0,1,1,0,0,1,1,1,0,
    0,1,1,0,0,0,0,0,1,1,
    0,1,1,0,0,0,0,0,1,1,
    0,1,1,1,0,0,0,1,1,1,
    0,0,1,1,1,1,1,1,1,0,
    0,0,0,1,1,1,1,1,0,0,
};
const unsigned char yzmw9[] = {
    0,0,0,1,1,1,1,0,0,0,
    0,0,1,1,1,1,1,1,1,0,
    0,1,1,1,0,0,0,1,1,0,
    0,1,1,0,0,0,0,0,1,1,
    0,1,1,0,0,0,0,0,1,1,
    0,1,1,1,0,0,0,1,1,1,
    0,0,1,1,1,1,1,1,1,1,
    0,0,0,1,1,1,1,0,1,1,
    0,0,0,0,0,0,0,0,1,1,
    0,0,0,0,0,0,0,1,1,0,
    0,0,1,0,0,0,0,1,1,0,
    0,0,1,1,1,1,1,1,0,0,
    0,0,0,1,1,1,1,0,0,0,
};


const unsigned char *m[]= {yzm1,yzm2,yzm3,yzmb,yzmc,yzmm,yzmn,yzmv,yzmx,yzmz};
const unsigned char *mw[]= {yzmw0,yzmw1,yzmw2,yzmw3,yzmw4,yzmw5,yzmw6,yzmw7,yzmw8,yzmw9};

const NSString *w[] = {@"1",@"2",@"3",@"b",@"c",@"m",@"n",@"v",@"x",@"z"};
const NSString *ww[] = {@"0",@"1",@"2",@"3",@"4",@"5",@"6",@"7",@"8",@"9"};


-(NSString *)shibie:(NSData*)data withW:(NSInteger)width withH:(NSInteger)height{
    NSString *yzm = @"";
    unsigned char *tu1 = (unsigned char *)data.bytes;//原图
    unsigned char *tu2 = malloc(width*height*sizeof(unsigned char));
    for (int i = 0; i<data.length/4; i++) {
        int liangdu = (*tu1+*(tu1+1)+*(tu1+2))/3>128;
        if(liangdu)*(tu2+i) = 0;
        else *(tu2+i) = 1;
        tu1+=4;
    }//二值化
    for (int qietu = 0; qietu<4; qietu++) {
        int err[10] = {0};
        for (int duibi = 0; duibi<10; duibi++) {
            for (int y = 0; y<12; y++) {
                for (int x = 0; x<9; x++) {
                    int col1 = *(tu2+x+3+10*qietu + (y+4)*width);
                    int col2 = *(m[duibi]+x+y*9);
                    if(col2>col1)err[duibi]++;
                }
            }
        }
        int wz = 0,min=100;
        for (int i=0; i<10; i++){
            if(err[i]<min){min=err[i];wz=i;}
        }
        yzm = [NSString stringWithFormat:@"%@%@",yzm,w[wz]];
    }
    free(tu2);
    
    return yzm;
}

-(NSString *)shibiew:(NSData*)data withW:(NSInteger)width withH:(NSInteger)height{
    NSString *yzm = @"";
    unsigned char *tu1 = (unsigned char *)data.bytes;//原图
    unsigned char *tu2 = malloc(width*height*sizeof(unsigned char));
    for (int i = 0; i<data.length/4; i++) {
        int liangdu = (*tu1+*(tu1+1)+*(tu1+2))/3>128;
        if(liangdu)*(tu2+i) = 0;
        else *(tu2+i) = 1;
        tu1+=4;
    }//二值化
    for (int qietu = 0; qietu<4; qietu++) {
        int err[10] = {0};
        for (int duibi = 0; duibi<10; duibi++) {
            for (int y = 0; y<13; y++) {
                for (int x = 0; x<10; x++) {
                    int col1 = *(tu2+x+6+13*qietu + (y+3)*width);
                    int col2 = *(mw[duibi]+x+y*10);
                    if(col2>col1)err[duibi]++;
                }
            }
        }
        int wz = 0,min=100;
        for (int i=0; i<10; i++){
            if(err[i]<min){
                min=err[i];wz=i;
            }
        }
        yzm = [NSString stringWithFormat:@"%@%@",yzm,ww[wz]];
    }
    free(tu2);
    return yzm;
}


-(void)shuchu:(NSData*)data{
    unsigned char *tu1 = (unsigned char *)data.bytes;//原图
    printf("const unsigned char yzm3[] = {");
    printf("\n");
    for (int i = 0; i<data.length/4; i++) {
        int liangdu = (*tu1+*(tu1+1)+*(tu1+2))/3<128;
        tu1+=4;
        printf("%d,",liangdu);
        if(i%10==9)printf("\n");
    }
    printf("}\n");
}

@end
